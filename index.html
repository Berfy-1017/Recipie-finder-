<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Penguin's Pantry Patrol</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Pacifico&display=swap');
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #d6e8ff, #a3c9ff);
      min-height: 100vh;
      margin: 0;
      color: #0f172a;
    }
    h1 { font-family: 'Pacifico', cursive; }
    button.gradient-btn {
      background: linear-gradient(90deg, #3b82f6, #6366f1);
      color: white; font-weight: 600;
      border-radius: 9999px;
      padding: 0.75rem 1.75rem;
      transition: background 0.3s ease;
    }
    button.gradient-btn:hover {
      background: linear-gradient(90deg, #2563eb, #4f46e5);
    }
    .penguin-chef { width: 300px; height: 300px; }
    .recipe-card {
      background-color: white;
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 15px rgb(0 0 0 / 0.1);
      display: flex; align-items: center; gap: 1rem;
      cursor: pointer;
      transition: box-shadow 0.3s ease;
    }
    .recipe-card:hover { box-shadow: 0 3px 25px rgb(0 0 0 / 0.15); }
    .recipe-img { width: 80px; height: 80px; border-radius: 0.5rem; object-fit: cover; }
    textarea[readonly] {
      background: #f3f4f6; border-radius: 0.5rem;
      padding: 1rem; width: 100%; resize: none;
      font-family: inherit; font-size: 1rem; color: #1e293b;
    }
  </style>
</head>
<body>
  <main id="app" class="max-w-3xl mx-auto p-6 flex flex-col items-center min-h-screen justify-center space-y-8">

    <!-- PAGE 1 -->
    <section id="page-1" class="w-full max-w-xl text-center">
      <h1 class="text-6xl mb-4">Penguin's Pantry Patrol</h1>
      <img src="penguin-chef.png" class="penguin-chef mx-auto mb-6"/>
      <p class="text-2xl mb-8">Your cheerful cooking partner, ready to share recipes anytime you are! ğŸ¤ğŸ´</p>
      <button class="gradient-btn text-lg px-10 py-4" id="btn-get-started">Get Started â†’</button>
    </section>

    <!-- PAGE 2 -->
    
    <section id="page-2" class="hidden w-full max-w-xl text-center">
  <h2 class="text-4xl font-bold mb-6">Ingredients</h2>
  <div class="flex flex-col items-center space-y-4">
    <input id="single-ingredient" type="text" placeholder="Type ingredient (e.g., Milk)" />
    
    <!-- Add a label for the date input -->
    <label for="date-bought" class="mb-1 font-medium">Date of Purchase:</label>
    <input id="date-bought" type="date" title="Date of Purchase" />

    <button id="btn-add-ingredient" class="gradient-btn w-44">Add Ingredient</button>
  </div>
  <ul id="live-ingredient-list" class="mt-6 bg-white rounded-lg shadow-md p-4 max-h-64 overflow-auto text-left space-y-2"></ul>
  <div class="mt-10 flex justify-center gap-6">
    <button id="btn-page2-home" class="gradient-btn px-8">Home</button>
    <button id="btn-page2-next" class="gradient-btn px-8">Next â†’</button>
  </div>
</section>


    <!-- PAGE 3 -->
    <section id="page-3" class="hidden w-full max-w-xl text-center">
      <h2 class="text-4xl font-bold mb-6">Your Ingredients & Freshness</h2>
      <button id="toggle-fresh" class="gradient-btn mb-4">Show Only Fresh</button>
      <ul id="ingredients-list" class="mb-6 bg-white rounded-lg shadow-md p-6 max-h-96 overflow-auto text-left space-y-3"></ul>
      <div class="mb-4 text-6xl" id="penguin-mood">ğŸ§</div>
      <div class="flex justify-center gap-6">
        <button id="btn-page3-back" class="gradient-btn px-8">â† Back</button>
        <button id="btn-page3-next" class="gradient-btn px-8">Next â†’</button>
      </div>
    </section>

    <!-- PAGE 4 -->
    <section id="page-4" class="hidden w-full max-w-xl text-center">
      <h2 class="text-4xl font-bold mb-4">Suggested Recipes</h2>
      <button id="toggle-recipe-fresh" class="gradient-btn mb-4">Show Only Fresh/Moderate Recipes</button>
      <div id="thinking-loader" class="hidden mb-6">
        <img src="penguin-thinking.gif" class="mx-auto w-32 h-32"/>
        <p class="mt-2 text-lg font-semibold">ğŸ“– Finding the perfect recipeâ€¦</p>
      </div>
      <div id="recipes-container" class="overflow-auto max-h-[48rem] px-2"></div>
      <div class="flex justify-center gap-6 mt-8">
        <button id="btn-page4-back" class="gradient-btn px-8">â† Back</button>
        <button id="btn-page4-home" class="gradient-btn px-8">ğŸ  Home</button>
      </div>
    </section>

    <!-- PAGE 5 -->
    <section id="page-5" class="hidden w-full max-w-xl text-center">
      <h2 id="recipe-title" class="text-3xl font-bold mb-4"></h2>
      <img id="recipe-image" class="mx-auto rounded-xl mb-4 w-96 h-80 object-cover" />
      <div id="penguin-reaction" class="text-6xl mb-6">ğŸ§</div>
      <h3 class="font-semibold text-xl mb-2">Instructions:</h3>
      <textarea id="instructions" readonly rows="8" class="mb-4"></textarea>
      <button id="btn-copy-instructions" class="gradient-btn w-52 mb-6">ğŸ“‹ Copy Instructions</button>
      <h3 class="font-semibold text-xl mb-2">Matched Ingredients:</h3>
      <ul id="matched-ingredients" class="mb-6 list-disc list-inside text-left"></ul>
      <h3 class="font-semibold text-xl mb-2">Missing Ingredients:</h3>
      <ul id="missing-ingredients" class="mb-6 list-disc list-inside text-left"></ul>
      <div class="flex justify-center gap-6 mt-8">
        <button id="btn-recipe-back" class="gradient-btn px-8">â† Back to Recipes</button>
        <button id="btn-recipe-try-another" class="gradient-btn px-8">ğŸ”„ Try Another Recipe</button>
      </div>
    </section>
  </main>

  <script>
    (() => {
      const pages = {1:page1= document.getElementById('page-1'),2:page2=document.getElementById('page-2'),3:page3=document.getElementById('page-3'),4:page4=document.getElementById('page-4'),5:page5=document.getElementById('page-5')};
      let ingredients=[], selectedRecipe=null, showFreshOnly=false, showFreshRecipesOnly=false;

      const btnGetStarted=document.getElementById('btn-get-started');
      const btnPage2Home=document.getElementById('btn-page2-home'), btnPage2Next=document.getElementById('btn-page2-next');
      const btnPage3Back=document.getElementById('btn-page3-back'), btnPage3Next=document.getElementById('btn-page3-next');
      const btnPage4Back=document.getElementById('btn-page4-back'), btnPage4Home=document.getElementById('btn-page4-home');
      const btnRecipeBack=document.getElementById('btn-recipe-back'), btnRecipeTryAnother=document.getElementById('btn-recipe-try-another');
      const btnAddIngredient=document.getElementById('btn-add-ingredient');
      const btnToggleFresh=document.getElementById('toggle-fresh');
      const btnToggleRecipeFresh=document.getElementById('toggle-recipe-fresh');

      const singleIngredientInput=document.getElementById('single-ingredient'), dateBoughtInput=document.getElementById('date-bought');
      const liveIngredientList=document.getElementById('live-ingredient-list'), ingredientsList=document.getElementById('ingredients-list');
      const penguinMood=document.getElementById('penguin-mood');
      const recipesContainer=document.getElementById('recipes-container'), thinkingLoader=document.getElementById('thinking-loader');
      const recipeTitle=document.getElementById('recipe-title'), recipeImage=document.getElementById('recipe-image');
      const instructionsArea=document.getElementById('instructions'), missingIngredientsList=document.getElementById('missing-ingredients'), matchedIngredientsList=document.getElementById('matched-ingredients');
      const penguinReaction=document.getElementById('penguin-reaction');

      function showPage(n){Object.values(pages).forEach(p=>p.classList.add('hidden'));pages[n].classList.remove('hidden');if(n===3)renderFreshness();if(n===4)fetchAndRenderRecipes();}

      btnGetStarted.onclick=()=>showPage(2);
      btnPage2Home.onclick=()=>{ingredients=[];liveIngredientList.innerHTML='';ingredientsList.innerHTML='';penguinMood.textContent='ğŸ§';showPage(1);};
      btnPage2Next.onclick=()=>showPage(3);
      btnPage3Back.onclick=()=>showPage(2);
      btnPage3Next.onclick=()=>showPage(4);
      btnPage4Back.onclick=()=>showPage(3);
      btnPage4Home.onclick=()=>{ingredients=[];liveIngredientList.innerHTML='';ingredientsList.innerHTML='';penguinMood.textContent='ğŸ§';showPage(1);};
      btnRecipeBack.onclick=()=>showPage(4);
      btnRecipeTryAnother.onclick=()=>showPage(4);

      btnAddIngredient.onclick=()=>{let n=singleIngredientInput.value.trim().toLowerCase();let d=dateBoughtInput.value;if(!n)return;if(!ingredients.some(i=>i.name===n))ingredients.push({name:n,dateBought:d?new Date(d):null});singleIngredientInput.value='';dateBoughtInput.value='';renderLiveList();};
      function renderLiveList(){liveIngredientList.innerHTML='';if(ingredients.length===0){liveIngredientList.innerHTML='<li>No ingredients yet.</li>';return;}ingredients.forEach(i=>{let li=document.createElement('li');li.textContent=i.name;liveIngredientList.appendChild(li);});}
      
      function freshnessStatus(date){if(!date)return'unknown';let d=(new Date()-date)/(1000*60*60*24);if(d<=3)return'fresh';if(d<=7)return'moderate';return'expired';}
      function freshnessEmoji(s){return{s:'âšª Unknown',fresh:'ğŸŸ¢ Fresh',moderate:'ğŸŸ¡ Moderate',expired:'ğŸ”´ Expired'}[s]||'âšª';}
      function renderFreshness(){ingredientsList.innerHTML='';let visible=showFreshOnly?ingredients.filter(i=>freshnessStatus(i.dateBought)==='fresh'):ingredients;let counts={fresh:0,moderate:0,expired:0};visible.forEach(({name,dateBought})=>{let s=freshnessStatus(dateBought);if(s!=='unknown')counts[s]++;let li=document.createElement('li');li.textContent=`${name} â€“ ${freshnessEmoji(s)}`;ingredientsList.appendChild(li);});let mood='ğŸ§';if(counts.expired>0)mood='ğŸ˜Ÿ';else if(counts.moderate>0)mood='ğŸ˜';else if(counts.fresh>0)mood='ğŸ˜€';penguinMood.textContent=mood;btnToggleFresh.textContent=showFreshOnly?'Show All Ingredients':'Show Only Fresh';}
      btnToggleFresh.onclick=()=>{showFreshOnly=!showFreshOnly;renderFreshness();};

      async function fetchAndRenderRecipes(){
        recipesContainer.innerHTML='';thinkingLoader.classList.remove('hidden');
        setTimeout(async()=>{
          try{let res=await fetch("recipes.json");let data=await res.json();let allMeals=data.recipes;
            let userIngredients=ingredients.map(i=>i.name.toLowerCase());
            let freshModerateIngredients=ingredients.filter(i=>{
              let s=freshnessStatus(i.dateBought);
              return s==='fresh'||s==='moderate';
            }).map(i=>i.name.toLowerCase());
            
            // filter base
            let meals=allMeals.filter(m=>m.ingredients.some(ing=>userIngredients.includes(ing.toLowerCase())));
            if(showFreshRecipesOnly){
              meals=meals.filter(m=>m.ingredients.some(ing=>freshModerateIngredients.includes(ing.toLowerCase())));
            }

            meals.sort((a,b)=>{
              let aMatches=a.ingredients.filter(ing=>userIngredients.includes(ing.toLowerCase())).length;
              let bMatches=b.ingredients.filter(ing=>userIngredients.includes(ing.toLowerCase())).length;
              return bMatches-aMatches;
            });

            thinkingLoader.classList.add('hidden');
            if(meals.length===0){recipesContainer.innerHTML='<p>No recipes found.</p>';return;}
            meals.forEach(m=>{
              let c=document.createElement('div');c.className='recipe-card';
              c.innerHTML=`<img src="${m.thumb||'penguin-chef.png'}" class="recipe-img"/><div><h3>${m.title}</h3></div>`;
              c.onclick=()=>loadRecipeDetails(m);recipesContainer.appendChild(c);
            });
          }catch{thinkingLoader.classList.add('hidden');recipesContainer.innerHTML='<p>Error loading recipes.</p>';}
        },1500);
      }
      btnToggleRecipeFresh.onclick=()=>{showFreshRecipesOnly=!showFreshRecipesOnly;btnToggleRecipeFresh.textContent=showFreshRecipesOnly?'Show All Recipes':'Show Only Fresh/Moderate Recipes';fetchAndRenderRecipes();};

      function loadRecipeDetails(m){recipeTitle.textContent=m.title;recipeImage.src=m.thumb||'penguin-cooking.gif';instructionsArea.value=m.instructions||'';matchedIngredientsList.innerHTML='';missingIngredientsList.innerHTML='';let recipeIngredients=m.ingredients.map(i=>i.toLowerCase());let userIngredients=ingredients.map(i=>i.name.toLowerCase());recipeIngredients.forEach(ri=>{let li=document.createElement('li');if(userIngredients.includes(ri))li.textContent=ri,matchedIngredientsList.appendChild(li);else li.textContent=ri,missingIngredientsList.appendChild(li);});penguinReaction.textContent=missingIngredientsList.children.length===0?'ğŸ‰':'ğŸ¤”';showPage(5);}
      showPage(1);
    })();
  </script>
</body>
</html>
